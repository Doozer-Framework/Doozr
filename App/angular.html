<!DOCTYPE html>
<html>
<head>
    <title>Restangular talks to DoozR implemented API</title>

    <script src="/www/view/assets/js/vendor/AngularJS-1.2.16.js"></script>
    <script src="/www/view/assets/js/vendor/underscore.js"></script>
    <script src="/www/view/assets/js/vendor/restangular-1.4.0.js"></script>
</head>
<body>

<script>
    /**
     * Add Restangular as a dependency to your app
     */
    var app = angular.module('ServiceConsumer', ['restangular']);

    /**
     * Add controller for retrieving User's data from backend via Restangular from API
     */
    app.controller('ServiceConsumerCtrl', function($scope, Restangular) {

        // For all operations goto base e.g. http://www.foo.bar/Api/...
        Restangular.setBaseUrl('/Api/');

        // Restangular returns promises -> GET: /User
        Restangular.one('User', 1234).getList()
            .then(function(user) {
                // returns a list of users
                $scope.users = user; // first Restangular obj in list: { id: 1234 }
            })
    });

    /**
     * Configure response extractor to match our service generic JSON response structure.
     */
    app.config(function(RestangularProvider) {

        // add a response intereceptor
        RestangularProvider.addResponseInterceptor(function($data, $operation, $what, $url, $response, $deferred) {

            var response;

            // .. to look for getList operations
            if ($operation === 'getList') {
                // .. and handle the data and meta data
                response = [$data.result];
            }

            return response;
        });
    });

</script>

<!-- APP_START: ServiceConsumer -->
<div ng-app="ServiceConsumer">
    <div ng-controller="ServiceConsumerCtrl">
        <ul>
            <li ng-repeat="user in users">
                Id: {{user.id}}<br>
                User: {{user.user}}<br>
                Firstname: {{user.firstname}}<br>
                lastname: {{user.lastname}}<br>
                email: {{user.email}}<br>
            </li>
        </ul>
    </div>
</div>
<!-- APP_END: serviceConsumer -->

</body>
</html>
